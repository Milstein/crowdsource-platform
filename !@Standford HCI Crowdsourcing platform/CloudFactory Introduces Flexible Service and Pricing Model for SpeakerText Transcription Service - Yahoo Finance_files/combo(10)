
/* content-share-buttons.js ac7c5e1 */ YUI.add("media-content-share-buttons",function(a){function b(c){b.superclass.constructor.apply(this,arguments)}b.NAME="mediacontentsharebuttons";a.extend(b,a.Media.MediaContentSocialBase,{initializer:function(d){var c=this;this.device=(a.Media&&a.Media.pageChrome&&a.Media.pageChrome.getDevice)?a.Media.pageChrome.getDevice():"full";this.modNode=a.one(d.modNode);this._onClickHandlers={};this.config=d;this.mod_id=b.NAME;this.checkPosInterval=null;this.checkPosIntervalCount=0;this._hasNativeTopButtons=(null!==a.one(".yom-share-btns-container.light .share-btns-int-container"));if(this._hasNativeTopButtons){this._handleTopButtons();this._bindTopButtonsEvt()}this.modNode.all(".share-btn a").setAttribute("data-share-sec","sh").setAttribute("data-share-pos","bottom");this._bindEvt();this._updateShareImage()},_handleTopButtons:function(){var c=a.one(".yom-share-btns-container.light");if(!c){return}c.setAttribute("id",b.NAME+"-light");c.all(".share-btn a").removeAttribute("data-ylk").removeAttribute("data-rapid_p").removeAttribute("data-action-outcome").setAttribute("data-share-pos","top").setAttribute("data-share-sec","sh-lt")},_bindEvt:function(){var d=a.one(".yog-bd");this.modNode.detach("share-btn|*");if(this.modNode.one(".share-link")){this._onClickHandlers.shareLink=this.modNode.one(".share-link").on("share-btn|click",this._clickLink,this);this._onClickHandlers.shareLinkNoCopy=this.modNode.one(".share-link").on("share-btn|keypress",this._preventCopy,this);this._onClickHandlers.shareLinkIcon=this.modNode.one(".share-link-icon").on("share-btn|click",this._clickLink,this);this.modNode.delegate("share-btn|focus",function(f){this._beaconEvent("click",{t1:"a3",t2:"sh-cp",sec:"sh-cp",elm:"inpt",elmt:"copy",slk:"copy",itc:1})},".share-link",this);this.modNode.delegate("share-btn|click",function(f){this._beaconEvent("click",{t1:"a3",t2:"sh-cp",sec:"sh-cp",elm:"icn",elmt:"copy",slk:"copy",itc:1})},".share-link-icon",this)}this._onClickHandlers.mixerUpdate=a.Global.on("share-btn|"+this.mod_id+":popupClose",function(f){var h="share",g="";if(f&&f.name){switch(f.name){case"facebook":h="fbshare";g="fb";break;case"twitter":h="twitter";g="tw";break;case"mail":h="email";g="ma";break;case"tumblr":h="tumblr";g="tu";break;case"gplus":h="gplus";g="gp";break;case"linkedin":h="linkedin";g="li";break;case"whatsapp":h="whatsapp";g="wa";break;default:h="share"}}this._updateMixer(h,this.config.config,this.config.contentMetaData)},this);if(this.device==="smartphone"){if(this.modNode.one(".hover-share-btns-container")){var c=a.one("body");c.detach("share-btn|*");if(a.UA.android>0){var e=this;c.on("share-btn|touchstart",function(f){e._handleScrollStart(f)});c.on("share-btn|touchcancel",function(f){e._handleScrollEnd(f);if(e.checkPosInterval===null){e.checkPosInterval=setInterval(function(){var h=a.one("body").get("scrollTop"),g=a.one("body").get("winHeight"),i=e.modNode.getY();e.checkPosIntervalCount++;if(h<50||i<50+h+g){e._handleScrollStart(f);clearInterval(e.checkPosInterval);e.checkPosInterval=null;e.checkPosIntervalCount=0}if(e.checkPosIntervalCount>15){clearInterval(e.checkPosInterval);e.checkPosInterval=null;e.checkPosIntervalCount=0}},300)}})}else{c.on("share-btn|gesturemovestart",this._handleScrollStart,null,this);c.on("share-btn|gesturemoveend",this._handleScrollEnd,null,this)}}}},_handleScrollStart:function(d){if(d.target.hasClass("btn-icon")||d.target.ancestor(".hover-share-btns-container")){return}var c=this.modNode.one(".hover-share-btns-container");if(!c.hasClass("hidden")){c.setStyles({transition:"opacity 0s",opacity:"0"});c.addClass("hidden")}},_handleScrollEnd:function(d){var c=this;setTimeout(function(){var f=c.modNode.one(".hover-share-btns-container"),g=a.one("body").get("scrollTop"),e=a.one("body").get("winHeight"),h=c.modNode.getY();if(g<50||h<50+g+e){return}if(f.hasClass("hidden")){f.setStyles({transition:"opacity 0.4s ease-in-out"});f.removeClass("hidden");setTimeout(function(){f.setStyles({opacity:"1"})},10)}},300)},_bindTopButtonsEvt:function(){var c=a.one("#"+b.NAME+"-light");if(!c){return}c.detach("share-btn|*");if(this.device!="smartphone"){c.delegate("share-btn|click",function(f){var d=f.currentTarget.getAttribute("data-share-key");if(d){a.Global.fire(this.mod_id+":clickButton");a.Global.fire(this.mod_id+":"+d,f.currentTarget)}},"a",this)}},_clickLink:function(d){d.preventDefault();d.stopPropagation();var c;if(d.currentTarget.get("nodeName").toLowerCase()==="input"){c=d.currentTarget}else{c=d.currentTarget.get("parentNode").one("input")}if(c){c.select();c.focus();c._node.setSelectionRange(0,9999)}},_preventCopy:function(c){if(!(c&&(c.altKey||c.ctrlKey||c.metaKey))){c.preventDefault()}return},_popupWindow:function(d,l,e,m,k){if(d===undefined||d==""){return}var e=(e)?e:500,m=(m)?m:450,k=(k===undefined)?"yes":"no";var f=window.outerWidth||document.documentElement.clientWidth||document.body.clientWidth;var c=window.outerHeight||document.documentElement.clientHeight||document.body.clientHeight;var i=window.screenX||window.screenLeft||0;var g=window.screenY||window.screenTop||0;var h=(f/2)-(e/2)+i;var j=(c/2)-(m/2)+g;return window.open(d,l,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars="+k+", resizable=yes, copyhistory=no, width="+e+", height="+m+", top="+j+", left="+h)},_updateShareImage:function(){var l=this.modNode.one(".facebook a"),f=this.modNode.one(".tumblr a"),k=l&&l.get("href"),e=f&&f.get("href"),i=a.one(".yom-share-btns-container.light"),h=this._getAlternativeImage();if(i){var d=i.one(".facebook a");tumblrLight=i.one(".tumblr a")}if(k&&-1!=k.indexOf("?")){var m=k.substr(0,k.indexOf("?")),j=a.QueryString.parse(k.substr(k.indexOf("?")+1));if(h&&j.picture&&j.picture.indexOf("social_default")>0){j.picture=h.get("src");l.set("href",m+"?"+a.QueryString.unescape(a.QueryString.stringify(j)));if(d){d.set("href",m+"?"+a.QueryString.unescape(a.QueryString.stringify(j)))}}}if(e&&-1!=e.indexOf("?")){var c=a.QueryString.parse(e.substr(e.indexOf("?")+1));if(h&&!c.clickthru){var g='<header><b><a href="'+c.url+'">'+a.one('meta[property="og:title"]').get("content")+"</a></b></header><br/><br/>";var n="https://www.tumblr.com/share/photo?clickthru="+encodeURIComponent(c.url)+"&caption="+encodeURIComponent("<article>"+g+"<section>"+c.description+"</section></article>")+"&source="+encodeURIComponent(h.get("src"));f.set("href",n);if(tumblrLight){tumblrLight.set("href",n)}}}},_getAlternativeImage:function(){var c;c=a.one("img.editorial");if(!c){c=a.one("#mediacontentstory figure img")}return c},destructor:function(){}});a.namespace("Media").ContentShareButtons=b},"0.0.2",{requires:["base","event-base","node-base","node-core","io","json","datatype","querystring","media-content-social-base","transition"]});